<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tic-Tac-Toe - Logic for Systems: Lightweight Formal Methods for Everybody</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../././mdbook-admonish.css">
        <link rel="stylesheet" href="../.././mdbook-admonish.css">
        <link rel="stylesheet" href="../.././custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../welcome.html">How to Read this book</a></li><li class="chapter-item affix "><li class="part-title">Preamble: Beyond Testing</li><li class="chapter-item "><a href="../../chapters/manifesto/job.html">What good is this book?</a></li><li class="chapter-item "><a href="../../chapters/manifesto/manifesto.html">Logic for Systems</a></li><li class="chapter-item "><a href="../../chapters/properties/pbt.html">From Tests to Properties</a></li><li class="chapter-item affix "><li class="part-title">Modeling Static Scenarios</li><li class="chapter-item expanded "><a href="../../chapters/ttt/ttt.html" class="active">Tic-Tac-Toe</a></li><li class="chapter-item "><a href="../../chapters/bst/bst.html">Binary Search Trees</a></li><li class="chapter-item "><a href="../../chapters/adder/rca.html">Ripple-Carry Adder</a></li><li class="chapter-item "><a href="../../chapters/qna/static.html">Q&A: Static Modeling</a></li><li class="chapter-item affix "><li class="part-title">Discrete Event Systems</li><li class="chapter-item "><a href="../../chapters/ttt/ttt_games.html">Transitions, Traces, and Verification</a></li><li class="chapter-item "><a href="../../chapters/inductive/bsearch.html">Counterexamples to Induction</a></li><li class="chapter-item "><a href="../../chapters/bst/descent.html">BSTs: Recursive Descent</a></li><li class="chapter-item "><a href="../../chapters/validation/validating_events.html">Validating Models (in progress)</a></li><li class="chapter-item "><a href="../../chapters/qna/events.html">Q&A: Event Systems (in progress)</a></li><li class="chapter-item affix "><li class="part-title">Modeling Relationships</li><li class="chapter-item "><a href="../../chapters/relations/modeling-booleans-1.html">Relational Forge, Modeling Logic</a></li><li class="chapter-item "><a href="../../chapters/relations/reachability.html">Transitive Closure</a></li><li class="chapter-item "><a href="../../chapters/relations/sets-induction-mutex.html">Modeling Mutual Exclusion</a></li><li class="chapter-item "><a href="../../chapters/relations/sets-beyond-assertions.html">Going Beyond Assertions</a></li><li class="chapter-item "><a href="../../chapters/solvers/bounds_booleans_how_forge_works.html">How does Forge Work?</a></li><li class="chapter-item "><a href="../../chapters/qna/relations.html">Q&A: Relations</a></li><li class="chapter-item affix "><li class="part-title">Temporal Specification</li><li class="chapter-item "><a href="../../chapters/temporal/liveness_and_lassos.html">Liveness and Lassos</a></li><li class="chapter-item "><a href="../../chapters/temporal/temporal_operators.html">Temporal Forge</a></li><li class="chapter-item "><a href="../../chapters/temporal/temporal_operators_2.html">Linear Temporal Logic</a></li><li class="chapter-item "><a href="../../chapters/temporal/obligations_past.html">Obligations and the Past</a></li><li class="chapter-item "><a href="../../chapters/temporal/fixing_lock_temporal.html">Mutual Exclusion, Revisited</a></li><li class="chapter-item affix "><li class="part-title">Additional Examples, Case Studies, and Further Reading</li><li class="chapter-item "><a href="../../chapters/raft/raft.html">Modeling Raft in Anger (in progress)</a></li><li class="chapter-item "><div>Forge: Comparing Prim's and Dijkstra's Algorithms (in progress)</div></li><li class="chapter-item "><div>Forge+Industry: Policy and Network Analysis (in progress; DEMO: ABAC, Margrave, Zelkova)</div></li><li class="chapter-item "><div>Forge+Industry: Crypto Protocol Analysis (in progress; DEMO: crypto lang, CPSA or other)</div></li><li class="chapter-item "><div>Program Synthesis (in progress; DEMO: SSA synth, Sygus)</div></li><li class="chapter-item "><a href="../../further_reading.html">Further Reading (in progress)</a></li><li class="chapter-item affix "><li class="part-title">Construction Storage</li><li class="chapter-item "><a href="../../chapters/solvers/dpll.html">DPLL (to edit)</a></li><li class="chapter-item "><a href="../../chapters/solvers/resolution.html">Propositional resolution (to edit)</a></li><li class="chapter-item affix "><li class="part-title">Forge Documentation</li><li class="chapter-item "><a href="../../chapters/docs/test.html">Forge Version</a></li><li class="chapter-item "><a href="../../docs/getting-started/installation.html">Installation</a></li><li class="chapter-item "><a href="../../docs/building-models/overview.html">Overview</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../docs/building-models/alloy-user-overview.html">Addendum for Alloy Users</a></li></ol></li><li class="chapter-item "><a href="../../docs/building-models/sigs/sigs.html">Sigs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../docs/building-models/sigs/inheritance.html">Inheritance</a></li><li class="chapter-item "><a href="../../docs/building-models/sigs/singleton-maybe-sigs.html">Singleton, Maybe, and Abstract Sigs</a></li><li class="chapter-item "><a href="../../docs/building-models/sigs/multiplicity.html">Field Multiplicity</a></li><li class="chapter-item "><a href="../../docs/building-models/sigs/advanced.html">Advanced: Sigs and fields, under-the-hood</a></li></ol></li><li class="chapter-item "><a href="../../docs/building-models/constraints/constraints.html">Constraints</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../docs/building-models/constraints/instances.html">Instances</a></li><li class="chapter-item "><a href="../../docs/building-models/constraints/formulas/formulas.html">Formulas</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../docs/building-models/constraints/formulas/operators.html">Operators</a></li><li class="chapter-item "><a href="../../docs/building-models/constraints/formulas/cardinality-membership.html">Cardinality and Membership</a></li><li class="chapter-item "><a href="../../docs/building-models/constraints/formulas/quantifiers.html">Quantifiers</a></li><li class="chapter-item "><a href="../../docs/building-models/constraints/formulas/predicates.html">Predicates</a></li></ol></li><li class="chapter-item "><a href="../../docs/building-models/constraints/expressions/expressions.html">Expressions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../docs/building-models/constraints/expressions/relational-expressions/relational-expressions.html">Relational Operators</a></li><li class="chapter-item "><a href="../../docs/building-models/constraints/expressions/functions.html">Functions</a></li><li class="chapter-item "><a href="../../docs/building-models/constraints/expressions/let-expressions.html">Let-Expressions</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../docs/building-models/comments.html">Comments</a></li><li class="chapter-item "><a href="../../docs/running-models/running.html">Running</a></li><li class="chapter-item "><a href="../../docs/running-models/sterling-visualizer.html">Sterling Visualizer</a></li><li class="chapter-item "><a href="../../docs/running-models/bounds.html">Bounds</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../docs/running-models/concrete-instance-bounds.html">Concrete Instance Bounds</a></li></ol></li><li class="chapter-item "><a href="../../docs/running-models/options.html">Options</a></li><li class="chapter-item "><a href="../../docs/testing-chapter/testing.html">Testing</a></li><li class="chapter-item "><a href="../../docs/forge-standard-library/integers.html">Integers</a></li><li class="chapter-item "><a href="../../docs/forge-standard-library/constants-and-keywords.html">Constants and Keywords</a></li><li class="chapter-item "><a href="../../docs/forge-standard-library/helpers.html">Helpers: Sequences and Reachability</a></li><li class="chapter-item "><a href="../../docs/electrum/electrum-overview.html">Temporal Forge Overview and Operators</a></li><li class="chapter-item "><a href="../../docs/sterling/custom-basics.html">Custom Visualization Basics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../docs/sterling/d3fx_apr23.html">D3FX Helpers (April 2023)</a></li><li class="chapter-item "><a href="../../docs/sterling/svg-tips.html">Working with SVG and Imports</a></li></ol></li><li class="chapter-item "><a href="../../docs/dsl/abac.html">Attribute-Based Access Control</a></li><li class="chapter-item "><a href="../../docs/glossary.html">What should I do if...</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Logic for Systems: Lightweight Formal Methods for Everybody</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="intro-to-modeling-systems-part-1-tic-tac-toe"><a class="header" href="#intro-to-modeling-systems-part-1-tic-tac-toe">Intro to Modeling Systems (Part 1: Tic-Tac-Toe)</a></h1>
<h2 id="whats-a-model"><a class="header" href="#whats-a-model">What's a Model?</a></h2>
<p>A <strong>model</strong> is a <em>representation</em> of a system that faithfully includes some but not all of the system's complexity. There are many different ways to model a system, all of which have different advantages and disadvantages. Think about what a car company does before it produces a new car design. Among other things, it creates multiple models. E.g.,</p>
<ul>
<li>it models the car in some computer-aided design tool; and then</li>
<li>creates a physical model of the car, perhaps with clay, for testing in wind tunnels etc.</li>
</ul>
<p>There may be many different models of a system, all of them focused on something different. As the statisticians say, &quot;all models are wrong, but some models are useful&quot;. Learning how to model a system is a key skill for engineers, not just within &quot;formal methods&quot;. Abstraction is one of the key tools in Computer Science, and modeling lies at the heart of abstraction.</p>
<p>In this course, <strong>the models we build aren't inert</strong>; we have tools that we can use the explore and analyze them!</p>
<h3 id="dont-be-afraid-of-imperfect-representations"><a class="header" href="#dont-be-afraid-of-imperfect-representations">Don't Be Afraid of Imperfect Representations</a></h3>
<p><em>We don't need to fully model a system to be able to make useful inferences</em>. We can simplify, omit, and abstract concepts/attributes to make models that approximate the system while preserving the fundamentals that we're interested in. </p>
<p><strong>Exercise:</strong> If you've studied physics, there's a great example of this in statics and dynamics. Suppose I drop a coin from the top of the science library, and ask you what its velocity will be when it hits the ground. Using the methods you learn in beginning physics, what's something you usefully <em>disregard</em>?</p>
<details>
<summary>Think, then click!</summary>
<p>Air resistance! Friction! We can still get a reasonable approximation for many problems without needing to include that. (And advanced physics adds even more factors that aren't worth considering at this scale.) The model without friction is often enough.</p>
</details>
<h2 id="what-is-a-system-models-vs-implementations"><a class="header" href="#what-is-a-system-models-vs-implementations">What is a &quot;System&quot;? (Models vs. Implementations)</a></h2>
<p>When we say &quot;systems&quot; in this book, we mean the term broadly. A distributed system (like <a href="https://github.com/visualzhou/mongo-repl-tla">replication in MongoDB</a>) is a system, but so are user interfaces and hardware devices like CPUs and insulin pumps. Git is a system for version control. The web stack, cryptographic protocols, chemical reactions, the rules of sports and games—these are all systems too!</p>
<p>To help build intuition, let's work with a simple system: the game of <a href="https://en.wikipedia.org/wiki/Tic-tac-toe">tic-tac-toe</a> (also called noughts and crosses). There are <em>many</em> implementations of this game, including <a href="https://csci1710.github.io/2023/examples/ttt.py">this one</a> that I wrote in Python. And, of course, these implementations often have corresponding test suites, like <a href="https://csci1710.github.io/2023/examples/test_ttt.py">this (incomplete) example</a>.</p>
<p><strong>Exercise</strong>: Play a quick game of tic-tac-toe by hand. If you can, find a partner, but if not, then play by yourself.</p>
<p>Notice what just happened. You played the game. In doing so, you ran your own mental implementation of the rules. The result you got was one of many possible games, each with its own specific sequence of legal moves, leading to a particular ending state. Maybe someone won, or maybe the game was a tie. Either way, many different games could have ended with that same board. </p>
<p>Modeling is different from programming. When you're programming traditionally, you give the computer a set of instructions and it follows them. This is true whether you're programming functionally or imperatively, with or without objects, etc. Declarative modeling languages like Forge work differently. The goal of a model isn't to <em>run instructions</em>, but rather to <em>describe the rules</em> that govern systems. </p>
<p>Here's a useful comparison to help reinforce the difference (with thanks to Daniel Jackson):</p>
<ul>
<li>An empty program <strong>does nothing</strong>.</li>
<li>An empty model <strong>allows every behavior</strong>.</li>
</ul>
<h2 id="modeling-tic-tac-toe-boards"><a class="header" href="#modeling-tic-tac-toe-boards">Modeling Tic-Tac-Toe Boards</a></h2>
<p>What are the essential concepts in a game of tic-tac-toe?</p>
<div id="admonition-modeling-methodology" class="admonition admonish-tip">
<div class="admonition-title">
<p>Modeling Methodology</p>
<p><a class="admonition-anchor-link" href="#admonition-modeling-methodology"></a></p>
</div>
<div>
<p>When we're first writing a model, we'll start with <strong>5 steps</strong>. For each step, I'll give examples from tic-tac-toe and also for binary search trees (which we'll start modeling soon) for contrast.</p>
<ul>
<li>What are the <strong>datatypes</strong> involved, and their <strong>fields</strong>? 
<ul>
<li>For tic-tac-toe: they might be the 3-by-3 board and the <code>X</code> and <code>O</code> marks that go in board locations. </li>
<li>For a binary search tree: they might be the tree nodes and their left and right children. </li>
</ul>
</li>
<li>What makes an instance of these datatypes <strong>well formed</strong>? That is, what conditions are needed for them to not be garbage? 
<ul>
<li>For tic-tac-toe, we might require that the indexes used are between <code>0</code> and <code>2</code>, since the board is 3-by-3. (We could just as easily use <code>1</code>, <code>2</code>, and <code>3</code>. I picked <code>0</code> as the starting point out of habit, because list indexes start from <code>0</code> in the programming languages I tend to use.)</li>
<li>For a binary search tree, we might require that every node has at most one left child, at most one right child, a unique parent, and so on.</li>
</ul>
</li>
<li>What's a small <strong>example</strong> of how these datatypes can be instantiated?
<ul>
<li>For tic-tac-toe, the empty board would be an example. So would the board where <code>X</code> moves first into the middle square.</li>
<li>For a binary search tree, this might be a tree with only one node, or a 3-node tree where the root's left and right children are leaves. </li>
</ul>
</li>
<li>What does the model look like when <strong>run</strong>?
<ul>
<li>For tic-tac-toe, we should see a board with some number of <code>X</code> and <code>O</code> marks.</li>
<li>For a binary search tree, we should see some set of nodes that forms a single tree via left- and right-children.</li>
</ul>
</li>
<li>What <strong>domain predicates</strong> are there? Well-formedness defines conditions that are needed for an instantiation to not be &quot;garbage&quot;. But whatever we're modeling surely has domain-specific concepts of its own, which may or may not hold. 
<ul>
<li>For tic-tac-toe, we care a great deal if the board is a winning board or not. Similarly, we might care if it looks like someone has cheated.</li>
<li>For a binary search tree, we care if the tree is balanced, or if it satisfies the BST invariant.</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="admonition-well-formedness-vs-domain-predicates" class="admonition admonish-warning">
<div class="admonition-title">
<p>Well-formedness vs. domain predicates</p>
<p><a class="admonition-anchor-link" href="#admonition-well-formedness-vs-domain-predicates"></a></p>
</div>
<div>
<p>Why make this distinction between well-formedness and domain predicates? Because one should always hold in any instance Forge considers, but the other may or may not hold. In fact, we might want to use Forge to <em>verify</em> that a domain predicate always holds! And if we've told Forge that any instance that doesn't satisfy it is garbage, Forge won't find us such an instance.</p>
</div>
</div>
<h3 id="datatypes"><a class="header" href="#datatypes">Datatypes</a></h3>
<p>We might list:</p>
<ul>
<li>the players <code>X</code> and <code>O</code>;</li>
<li>the 3-by-3 game board, where players can put their marks;</li>
<li>the idea of whose turn it is at any given time; and</li>
<li>the idea of who has won the game at any given time.</li>
</ul>
<p>Now let's add those ideas to a model in Forge! </p>
<pre><code class="language-forge editable">#lang forge/froglet
</code></pre>
<p>The first line of any Forge model will be a <code>#lang</code> line, which says which Forge language the file uses. We'll start with the Froglet language for now. Everything you learn in this language will apply in other Forge languages, so I'll use &quot;Forge&quot; interchangeably.</p>
<p>Now we need a way to talk about the noughts and crosses themselves. So let's add a <code>sig</code> that represents them:</p>
<pre><code class="language-forge editable">#lang forge/froglet
abstract sig Player {}
one sig X, O extends Player {}
</code></pre>
<p>You can think of <code>sig</code> in Forge as declaring a kind of object. A <code>sig</code> can extend another, in which case we say that it is a <em>child</em> of its parent, and child <code>sig</code>s cannot overlap. When a sig is <code>abstract</code>, any member must also be a member of one of that <code>sig</code>'s children; in this case, any <code>Player</code> must either be <code>X</code> or <code>O</code>. Finally, a <code>one</code> sig has exactly one member—there's only a single <code>X</code> and <code>O</code> in our model.</p>
<p>We also need a way to represent the game board. We have a few options here: we could create an <code>Index</code> sig, and encode an ordering on those (something like &quot;column A, then column B, then column C&quot;). Another is to use Forge's integer support. Both solutions have their pros and cons. Let's use integers, in part to get some practice with them.</p>
<!-- this shows the play button if we say it is Rust. We have control over what to *do* 
with the highlighting and play button via theme/book.js, so mislead mdbook a bit...
-->
<!-- ```rust,editable -->
<pre><code class="language-forge editable">#lang forge/froglet
abstract sig Player {}
one sig X, O extends Player {}

sig Board {
  board: pfunc Int -&gt; Int -&gt; Player
}
</code></pre>
<p>Every <code>Board</code> object contains a <code>board</code> field describing the moves made so far. This field is a <em>partial function</em>, or dictionary, for every <code>Board</code> that maps each (<code>Int</code>, <code>Int</code>) pair to at most one <code>Player</code>. </p>
<!--
a table of (`Int`, `Int`, `Player`) tuples for each `Board`. We'll see how to work with this field shortly.
-->
<h3 id="well-formedness"><a class="header" href="#well-formedness">Well-formedness</a></h3>
<p>These definitions sketch the overall shape of a board: players, marks on the board, and so on. But not all boards that fit the definition will be valid. For example:</p>
<ul>
<li>Forge integers aren't true mathematical integers, but are bounded by a bitwidth we give whenever we run the tool. So we need to be careful here. We want a classical 3-by-3 board with indexes of (say) <code>0</code>, <code>1</code>, and <code>2</code>, not a board where (e.g.) row <code>-5</code>, column <code>-1</code> is a valid location. </li>
</ul>
<p>We'll call these <em>well-formedness</em> constraints. They aren't innately enforced by our <code>sig</code> declarations, but we'll almost always want Forge to enforce them, so that it doesn't find &quot;garbage instances&quot;. Let's write a <em>wellformedness predicate</em>:</p>
<pre><code class="language-forge editable">-- a Board is well-formed if and only if:
pred wellformed[b: Board] {
  -- row and column numbers used are between 0 and 2, inclusive  
  all row, col: Int | {
    (row &lt; 0 or row &gt; 2 or col &lt; 0 or col &gt; 2) 
      implies no b.board[row][col]      
  }
}
</code></pre>
<div id="admonition-comments-in-forge" class="admonition admonish-tip">
<div class="admonition-title">
<p>Comments in Forge</p>
<p><a class="admonition-anchor-link" href="#admonition-comments-in-forge"></a></p>
</div>
<div>
<p>Forge treats either <code>--</code> or <code>//</code> as beginning a line-level comment, and <code>/* ... */</code> as denoting a block comment. This is different from the Python code we saw in the last section! In Forge, <code>#</code> has a different meaning.</p>
</div>
</div>
<p>This predicate is true of any <code>Board</code> if and only if the above 2 constraints are satisfied. Let's break down the syntax: </p>
<ul>
<li>Constraints can quantify over a domain. E.g.,<code>all row, col: Int | ...</code> says that for any pair of integers (up to the given bitwidth), the following condition (<code>...</code>) must hold. Forge also supports, e.g., existential quantification (<code>some</code>), but we don't need that yet. We also have access to standard boolean operators like <code>or</code>, <code>implies</code>, etc. </li>
<li><em>Formulas</em> in Forge always evaluate to a boolean; <em>expressions</em> evaluate to sets. For example,
<ul>
<li>the <em>expression</em> <code>b.board[row][col]</code> evaluates to the <code>Player</code> (if any) with a mark at location (<code>row</code>, <code>col</code>) in board <code>b</code>; but</li>
<li>the <em>formula</em> <code>no b.board[row][col]</code> is true if and only if there is no such `Player``.</li>
</ul>
</li>
<li>A <code>pred</code> (predicate) in Forge is a helper function that evaluates to a boolean. Thus, its body should always be a formula. </li>
</ul>
<div id="admonition-predicates-are-declarative" class="admonition admonish-tip">
<div class="admonition-title">
<p>Predicates are declarative</p>
<p><a class="admonition-anchor-link" href="#admonition-predicates-are-declarative"></a></p>
</div>
<div>
<p>Notice that, rather than describing a process that produces a well-formed board, or even instructions to check well-formedness, we've just given a declarative description of what's necessary and sufficient for a board to be well-formed. If we'd left the predicate body empty, <em>any</em> board would be considered well-formed—there'd be no formulas to enforce!</p>
</div>
</div>
<h3 id="a-few-examples"><a class="header" href="#a-few-examples">A Few Examples</a></h3>
<p>Since a predicate is just a function that returns true or false, depending on its arguments and whichever instance Forge is looking at, we can write tests for it the same way we would for any other boolean-valued function. But even if we're not testing, it can be useful to write a small number of examples, so we can build intuition for what the predicate means.</p>
<p>In Forge, <code>example</code>s are automatically run whenever your model executes. They describe basic intent about a given predicate; in this case, let's write two examples in Forge:</p>
<ul>
<li>A board where <code>X</code> has moved 3 times in valid locations, and so ought to be considered well formed. </li>
<li>A board where a player has moved in an invalid location, and shouldn't be considered well formed. </li>
</ul>
<p>Notice that we're not making judgements about the rules being obeyed yet—just about whether our <code>wellformed</code> predicate is behaving the way we expect. And the <code>wellformed</code> predicate isn't aware of things like &quot;taking turns&quot; or &quot;stop after someone has won&quot;, etc. It just knows about the valid indexes being <code>0</code>, <code>1</code>, and <code>2</code>.</p>
<p>We'll write those two examples in Forge:</p>
<pre><code class="language-forge editable">-- Helper to make these examples easier to write
pred all_wellformed { all b: Board | wellformed[b]}

-- all_wellformed should be _true_ for the following instance
example firstRowX_wellformed is {all_wellformed} for {
  Board = `Board0                 -- backquote labels specific atoms
  X = `X      O = `O              -- examples must define all sigs
  Player = X + O                  -- only two kinds of player
  `Board0.board = (0, 0) -&gt; `X +  -- the partial function for the board's
                  (0, 1) -&gt; `X +  -- contents (unmentioned squares must 
                  (0, 2) -&gt; `X    -- remain empty, because we used &quot;=&quot; to say
                                  -- &quot;here's the function for `board0&quot;)
}

-- all_wellformed should be _false_ for the following instance
example off_board_not_wellformed is {not all_wellformed} for {
  Board = `Board0 
  X = `X      O = `O 
  Player = X + O
  `Board0.board = (-1, 0) -&gt; `X +
                  (0, 1) -&gt; `X + 
                  (0, 2) -&gt; `X 
}
</code></pre>
<div id="admonition-test-in-both-directions" class="admonition admonish-warning">
<div class="admonition-title">
<p>Test in both directions</p>
<p><a class="admonition-anchor-link" href="#admonition-test-in-both-directions"></a></p>
</div>
<div>
<p>Notice that we've got a test thats a <em>positive</em> example and another test that's a <em>negative</em> example. We want to make sure to exercise both cases, or else &quot;always true&quot; or &quot;always&quot; false could pass our suite.</p>
</div>
</div>
<h3 id="running-forge"><a class="header" href="#running-forge">Running Forge</a></h3>
<p>The <code>run</code> command tells Forge to search for an <em>instance</em> satisfying the given constraints:</p>
<pre><code class="language-forge editable">run { some b: Board | wellformed[b]} 
</code></pre>
<p>(If you're curious about <em>how</em> Forge finds solutions, you can find a brief sketch in <a href="../qna/static.html">the Q&amp;A for this chapter</a>.)</p>
<p>When we click the play button in the VSCode extension, the engine solves the constraints and produces a satisfying instance,  (Because of differences across solver versions, hardware, etc., it's possible you'll see a different instance than the one shown here.) A browser window should pop up with a visualization. You can also run <code>racket &lt;filename.frg&gt;</code> in the terminal, although we recommend the VSCode extension. </p>
<!-- Alloy -->
<!-- <img style="float: right;"  src="https://i.imgur.com/jTwED1K.png"/> -->
<!-- 
<img style="float: right;" src="https://i.imgur.com/34krUGX.png"/>
 -->
<div id="admonition-running-forge-on-windows" class="admonition admonish-warning">
<div class="admonition-title">
<p>Running Forge on Windows</p>
<p><a class="admonition-anchor-link" href="#admonition-running-forge-on-windows"></a></p>
</div>
<div>
<p>If you're running on Windows, the Windows-native <code>cmd</code> and PowerShell terminals will not properly load Forge's visualizer. Instead, we suggest using one of many other options on Windows that we've tested and know to work: the VSCode extension (available on the VSCode Marketplace), DrRacket, Git for Windows (e.g., <code>git bash</code>), Windows Subsystem for Linux, or Cygwin.</p>
</div>
</div>
<hr />
<p>There are many options for visualization. The default which loads initially is a directed-graph based one:</p>
<center><img width="70%" src="./ttt-viz.png"/></center>
<p><strong>(TODO: make this clickable to show it bigger? Want to see the whole window, but then the graph is small.)</strong></p>
<p>This isn't very useful; it looks nothing like a tic-tac-toe board! We can make more progress by using the &quot;Table&quot; visualization—which isn't ideal either:</p>
<center><img width="40%" src="./ttt-viz-table.png"/></center>
<p>Forge also allows users to make <em>custom</em> visualizations via short JavaScript programs; <a href="./ttt.js">here's</a> an example basic visualizer for this specific tic-tac-toe model that produces images like this one:</p>
<center><img width="20%" src="./ttt-custom.png"/></center>
<p>We'll talk more about visualization scripts later. For now, let's proceed. <strong>TODO: replace img with one matching the table view</strong>
<strong>TODO: add side-by-side CSS</strong></p>
<hr />
<p>This instance contains a single board, and it has 9 entries. Player <code>O</code> has moved in all of them (the <code>0</code> suffix of <code>O0</code> in the display is an artifact of how Forge's engine works; ignore it for now). It's worth noticing two things:</p>
<ul>
<li>This board doesn't look quite right: player <code>O</code> occupies all the squares. We might ask: has player <code>O</code> been cheating? But the fact is that this board <em>satisfies the constraints we have written so far</em>. Forge produces it simply because our model isn't yet restrictive enough, and for no other reason. &quot;Cheating&quot; doesn't exist yet. </li>
<li>We didn't say <em>how</em> to find that instance. We just said what we wanted, and the tool performed some kind of search to find it. So far the objects are simple, and the constraints basic, but hopefully the power of the idea is coming into focus. </li>
</ul>
<div id="admonition-why-board3-when-theres-only-one-board" class="admonition admonish-note">
<div class="admonition-title">
<p>Why <code>Board3</code> when there's only one board?</p>
<p><a class="admonition-anchor-link" href="#admonition-why-board3-when-theres-only-one-board"></a></p>
</div>
<div>
<p>Here, we see <code>Board3</code> because the solver had a few options to pick from: we never said there should only ever be one <code>Board</code>, after all. So, under the hood, it was considering the potential existence of multiple boards. And then it happened to pick this one to exist in this instance.</p>
</div>
</div>
<h3 id="reflection-implementation-vs-model"><a class="header" href="#reflection-implementation-vs-model">Reflection: Implementation vs. Model</a></h3>
<p>So far we've just modeled boards, not full games. But we can still contrast our work here against the Python <em>implementation</em> of tic-tac-toe shared above. </p>
<p><strong>Exercise:</strong> How do the data-structure choices, and type declarations, in the implementation compare with the essence of the game as reflected in the model? What is shared, and what is different? </p>
<p>Spend a minute identifying at least one commonality and at least one difference, then move on.</p>
<h2 id="domain-predicates"><a class="header" href="#domain-predicates">Domain Predicates</a></h2>
<p>Now let's write predicates that describe important ideas in the domain. What's important in the game of tic-tac-toe? Here are a few things.</p>
<h3 id="starting-boards"><a class="header" href="#starting-boards">Starting Boards</a></h3>
<p>What would it mean to be a <em>starting state</em> in a game? The board is empty:</p>
<pre><code class="language-forge editable">pred starting[s: Board] {
  all row, col: Int | 
    no s.board[row][col]
}
</code></pre>
<h3 id="turns"><a class="header" href="#turns">Turns</a></h3>
<p>How do we tell when it's a given player's turn? It's <code>X</code>'s turn when there are the same number of each mark on the board:</p>
<pre><code class="language-forge editable">pred XTurn[s: Board] {
  #{row, col: Int | s.board[row][col] = X} =
  #{row, col: Int | s.board[row][col] = O}
}
</code></pre>
<p>Here, we're measuring the size of 2 sets. The <code>{row, col: Int | ...}</code> syntax is called a <em>set comprehension</em>. A set comprehension defines a set. We're defining the set of row-column pairs where the board contains one of the player marks. The <code>#</code> operator gives the size of these sets, which we then compare.</p>
<p><strong>Exercise:</strong> Is it enough to say that <code>OTurn</code> is the negation of <code>XTurn</code>? That is, we could write: <code>pred OTurn[s: Board] { not XTurn[s: Board]}</code>. This seems reasonable enough; why might we <em>not</em> want to write this?</p>
<details>
<summary>Think, then click!</summary>
<p>Because we defined X's turn to be when the number of X's and O's on the board are in balance. So any <em>other</em> board would be O's turn, including ones that ought to be illegal, once we start defining moves of the game. Instead, let's say something like this:</p>
<pre><code class="language-forge editable">pred OTurn[s: Board] {
  -- It's O's turn if X has moved once more often than O has
  #{row, col: Int | s.board[row][col] = X} =
  add[#{row, col: Int | s.board[row][col] = O}, 1]
}
</code></pre>
</details>
<hr />
<div id="admonition-integer-addition" class="admonition admonish-note">
<div class="admonition-title">
<p>Integer addition</p>
<p><a class="admonition-anchor-link" href="#admonition-integer-addition"></a></p>
</div>
<div>
<p>Forge supports arithmetic operations on integers like <code>add</code>. Forge integers are signed (i.e., can be positive or negative) and are bounded by a <em>bit width</em>, which defaults to <code>4</code> bits. The number of available integers is always $2^k$, where $k$ is the bit width.</p>
<p>Forge follows the <a href="https://en.wikipedia.org/wiki/Two%27s_complement">2's complement arithmetic</a> convention, which means that the available integers are split evenly between positive and negative numbers, but counting <code>0</code> as &quot;positive&quot;. So with 4 bits, we can represent numbers between <code>-8</code> and <code>7</code> (inclusive).</p>
<p>This means that (while it doesn't matter for this model yet), arithmetic operations can overflow—just like primitive integers in languages like Java! For example, if we're working with 4-bit integers, then <code>add[7,1]</code> will be <code>-8</code>. You can experiment with this in the visualizer's <em>evaluator</em>, which we'll be using a lot after the initial modeling tour is done.</p>
</div>
</div>
<div id="admonition-use-add-for-addition-not-" class="admonition admonish-warning">
<div class="admonition-title">
<p>Use <code>add</code> for addition, not <code>+</code></p>
<p><a class="admonition-anchor-link" href="#admonition-use-add-for-addition-not-"></a></p>
</div>
<div>
<p>Don't try to use <code>+</code> for addition in any Forge language. Use <code>add</code> instead; this is because <code>+</code> is reserved for something else (which we'll explain later).</p>
</div>
</div>
<h3 id="winning-the-game"><a class="header" href="#winning-the-game">Winning the Game</a></h3>
<p>What does it mean to <em>win</em>? A player has won on a given board if:</p>
<ul>
<li>they have placed their mark in all 3 columns of a row; </li>
<li>they have placed their mark in all 3 rows of a column; or</li>
<li>they have placed their mark in all 3 squares of a diagonal.</li>
</ul>
<p>We'll express this in a <code>winner</code> predicate that takes the current board and a player name. Let's also define a couple helper predicates along the way:</p>
<pre><code class="language-forge editable">pred winRow[s: Board, p: Player] {
  -- note we cannot use `all` here because there are more Ints  
  some row: Int | {
    s.board[row][0] = p
    s.board[row][1] = p
    s.board[row][2] = p
  }
}

pred winCol[s: Board, p: Player] {
  some column: Int | {
    s.board[0][column] = p
    s.board[1][column] = p
    s.board[2][column] = p
  }      
}

pred winner[s: Board, p: Player] {
  winRow[s, p]
  or
  winCol[s, p]
  or 
  {
    s.board[0][0] = p
    s.board[1][1] = p
    s.board[2][2] = p
  } or {
    s.board[0][2] = p
    s.board[1][1] = p
    s.board[2][0] = p
  }  
}
</code></pre>
<p>After writing these domain predicates, we're reaching a fairly complete model for a single tic-tac-toe board. Let's decide how to fix the issue we saw above (the reason why <code>OTurn</code> couldn't be the negation of <code>XTurn</code>): perhaps a player has moved too often.</p>
<p>Should we add something like <code>OTurn[s] or XTurn[s]</code> to our wellformedness predicate? <strong>No!</strong> If we then later enforced wellformedness for all boards, that would exclude &quot;cheating&quot; instances where a player has more moves on the board than are allowed. But this has some risk, depending on how we intend to use the <code>wellformed</code> predicate:</p>
<ul>
<li>If we were only ever generating <em>valid boards</em>, a cheating state might well be spurious, or at least undesirable. In that case, we might prevent such states in <code>wellformed</code> and rule it out. </li>
<li>If we were generating arbitrary (not necessarily valid) boards, being able to see a cheating state might be useful. In that case, we'd leave it out of <code>wellformed</code>.</li>
<li>If we're interested in <em>verification</em>, e.g., we are asking whether the game of Tic-Tac-Toe enables ever reaching a cheating board, we shouldn't add <code>not cheating</code> to <code>wellformed</code>; because <code>wellformed</code> also excludes garbage boards, we'd probably use it in our verification—in which case, Forge will never find us a counterexample! </li>
</ul>
<div id="admonition-modeling-vs-pbt" class="admonition admonish-tip">
<div class="admonition-title">
<p>Modeling vs. PBT</p>
<p><a class="admonition-anchor-link" href="#admonition-modeling-vs-pbt"></a></p>
</div>
<div>
<p>Notice the similarity between this issue and what we do in property-based testing. Here, we're forced to distinguish between what a reasonable <em>board</em> is (analogous to the generator's output in PBT) and what a reasonable <em>behavior</em> is (analogous to the validity predicate in PBT). One narrows the scope of possible worlds to avoid true &quot;garbage&quot;; the other checks whether the system behaves as expected in one of those worlds.</p>
</div>
</div>
<p>We'll come back to this later, when we've had a bit more modeling experience. For now, let's separate our goal into a new predicate called <code>balanced</code>, and add it to our <code>run</code> command above so that Forge will find us an instance where some board is both <code>balanced</code> and <code>wellformed</code>:</p>
<pre><code class="language-forge editable">pred balanced[s: Board] {
  XTurn[s] or OTurn[s]
}
run { some b: Board | wellformed[b] and balanced[b]} 
</code></pre>
<p>If we click the &quot;Next&quot; button a few times, we see that not all is well: we're getting boards where <code>wellformed</code> is violated (e.g., entries at negative rows, or multiple moves in one square). Why is this happening?</p>
<p>We're getting this because of how the <code>run</code> was phrased. We said to find an instance where <em>some board</em> was well-formed and valid, not one where <em>all boards</em> were. Our <code>run</code> is satisfied by any instance where <em>at least one</em> <code>Board</code> is <code>wellformed</code>; the others won't affect the truth of the constraint. By default, Forge will find instances with up to 4 <code>Boards</code>. So we can fix the problem either by telling Forge to find instances with only 1 Board:</p>
<pre><code class="language-forge editable">run { some b: Board | wellformed[b] and balanced[b]} 
for exactly 1 Board
</code></pre>
<p>or by saying that all boards must be well-formed and balanced:</p>
<pre><code class="language-forge editable">run { all b: Board | wellformed[b] and balanced[b]} 
</code></pre>
<h2 id="practice-with-run"><a class="header" href="#practice-with-run">Practice with <code>run</code></a></h2>
<p>The <code>run</code> command can be used to give Forge more detailed instructions for its search. </p>
<h3 id="no-boards"><a class="header" href="#no-boards">No Boards</a></h3>
<p><strong>Exercise:</strong> Is it possible for an instance with <em>no</em> boards to still satisfy constraints like these?</p>
<pre><code class="language-alloy">run {    
     all b: Board | {
         -- X has won, and the board looks OK
         wellformed[b]
         winner[b, X]
         balanced[b]    
     }
 }
</code></pre>
<details>
<summary>Think, then click!</summary>
<p>Yes! There aren't any boards, so there's no obligation for anything to satisfy the constraints inside the quantifier. You can think of the <code>all</code> as something like a <code>for</code> loop in Java or the <code>all()</code> function in Python: it checks every <code>Board</code> in the instance. If there aren't any, there's nothing to check—return true.</p>
</details>
<h3 id="adding-more"><a class="header" href="#adding-more">Adding More</a></h3>
<p>This addition also requires that <code>X</code> moved in the middle of the board:</p>
<pre><code class="language-alloy">run {    
     all b: Board | {
         -- X has won, and the board looks OK
         wellformed[b]
         winner[b, X]
         balanced[b]
         -- X started in the middle
         b.board[1][1] = X
     }
 } for exactly 2 Board
</code></pre>
<p>Notice that, because we said <code>exactly 2 Board</code> here, Forge <em>must</em> find instances containing 2 tic-tac-toe boards, and both of them must satisfy the constraints: wellformedness, <code>X</code> moving in the middle, etc. You could ask for a board where <code>X</code> <em>hasn't</em> won by adding <code>not winner[b, X]</code>. </p>
<!-- You also have `implies` and `iff` (if and only if), although you can still do something like comparing two predicates without `iff` (try, e.g., asking for instances where `A and not B` holds).  -->
<p>We'll come back to tic-tac-toe soon; for now, let's cover another static example.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../chapters/properties/pbt.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../chapters/bst/bst.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../chapters/properties/pbt.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../chapters/bst/bst.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js"></script>
        <script src="../../editor.js"></script>
        <script src="../../mode-rust.js"></script>
        <script src="../../theme-dawn.js"></script>
        <script src="../../theme-tomorrow_night.js"></script>

        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
